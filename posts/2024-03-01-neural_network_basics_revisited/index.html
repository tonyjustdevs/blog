<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tony Phung">
<meta name="dcterms.date" content="2024-03-04">
<meta name="description" content="Deeper dive into Neural Network basics">

<title>Tony’s blog - Neural Networks Basics (Revisited) - [DRAFT TBC 02/3/24]</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Tony’s blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../kaggle.html"> 
<span class="menu-text">kaggle</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../leetcode.html"> 
<span class="menu-text">leetcode</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notes.html"> 
<span class="menu-text">notes</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tonyjustdevs"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://au.linkedin.com/in/tony-phung-6190b0b8"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Neural Networks Basics (Revisited) - [DRAFT TBC 02/3/24]</h1>
                  <div>
        <div class="description">
          Deeper dive into Neural Network basics
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">deep dive</div>
                <div class="quarto-category">laymens</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Tony Phung </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 4, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1. Introduction</a>
  <ul class="collapse">
  <li><a href="#the-mission" id="toc-the-mission" class="nav-link" data-scroll-target="#the-mission">1.1 The Mission</a></li>
  <li><a href="#the-mathematical-model" id="toc-the-mathematical-model" class="nav-link" data-scroll-target="#the-mathematical-model">1.2 The Mathematical Model</a>
  <ul class="collapse">
  <li><a href="#laymens-mathematical-model" id="toc-laymens-mathematical-model" class="nav-link" data-scroll-target="#laymens-mathematical-model">1.2.1 Laymens (mathematical model):</a></li>
  </ul></li>
  <li><a href="#mathematical-models-examples" id="toc-mathematical-models-examples" class="nav-link" data-scroll-target="#mathematical-models-examples">1.3 Mathematical models examples</a></li>
  </ul></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">2. Data Preparation</a>
  <ul class="collapse">
  <li><a href="#choose-a-model" id="toc-choose-a-model" class="nav-link" data-scroll-target="#choose-a-model">2.1 Choose a Model</a>
  <ul class="collapse">
  <li><a href="#quadratic-equation-example" id="toc-quadratic-equation-example" class="nav-link" data-scroll-target="#quadratic-equation-example">2.1.1 Quadratic Equation Example</a></li>
  </ul></li>
  <li><a href="#make-predictions-with-our-model" id="toc-make-predictions-with-our-model" class="nav-link" data-scroll-target="#make-predictions-with-our-model">2.2 Make Predictions with our Model</a></li>
  <li><a href="#starting-inputs-variables-x_1-x_2-...-x_n" id="toc-starting-inputs-variables-x_1-x_2-...-x_n" class="nav-link" data-scroll-target="#starting-inputs-variables-x_1-x_2-...-x_n">2.3 <strong><em>Starting</em></strong> Inputs Variables <span class="math inline">\(x_1, x_2, ... , x_n\)</span></a>
  <ul class="collapse">
  <li><a href="#good-starting-inputs-variables" id="toc-good-starting-inputs-variables" class="nav-link" data-scroll-target="#good-starting-inputs-variables">2.3.1 Good Starting Inputs Variables</a></li>
  <li><a href="#bad-starting-inputs" id="toc-bad-starting-inputs" class="nav-link" data-scroll-target="#bad-starting-inputs">2.3.2 Bad Starting Inputs</a></li>
  </ul></li>
  <li><a href="#starting-coefficients-x_1-x_2-...-x_n" id="toc-starting-coefficients-x_1-x_2-...-x_n" class="nav-link" data-scroll-target="#starting-coefficients-x_1-x_2-...-x_n">2.4 <strong><em>Starting</em></strong> Coefficients <span class="math inline">\(x_1, x_2, ... , x_n\)</span></a>
  <ul class="collapse">
  <li><a href="#about-zero" id="toc-about-zero" class="nav-link" data-scroll-target="#about-zero">2.4.1 About Zero</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">2.4.1.1 Example</a></li>
  <li><a href="#titanic" id="toc-titanic" class="nav-link" data-scroll-target="#titanic">2.4.2 Titanic</a></li>
  <li><a href="#preset-coefficients-and-pre-trained-models" id="toc-preset-coefficients-and-pre-trained-models" class="nav-link" data-scroll-target="#preset-coefficients-and-pre-trained-models">2.4.3 Preset Coefficients and Pre-trained Models</a></li>
  <li><a href="#isnt-it-all-relative" id="toc-isnt-it-all-relative" class="nav-link" data-scroll-target="#isnt-it-all-relative">2.4.4 Isn’t it all relative?</a></li>
  </ul></li>
  <li><a href="#normalisation" id="toc-normalisation" class="nav-link" data-scroll-target="#normalisation">3. Normalisation</a></li>
  <li><a href="#numerical-data-techniques" id="toc-numerical-data-techniques" class="nav-link" data-scroll-target="#numerical-data-techniques">3.1 Numerical Data Techniques:</a>
  <ul class="collapse">
  <li><a href="#problem-with-normalised-data" id="toc-problem-with-normalised-data" class="nav-link" data-scroll-target="#problem-with-normalised-data">3.1.1 Problem with Normalised Data</a></li>
  <li><a href="#benefits-to-gradient-descent" id="toc-benefits-to-gradient-descent" class="nav-link" data-scroll-target="#benefits-to-gradient-descent">3.1.2 Benefits to Gradient Descent</a></li>
  </ul></li>
  <li><a href="#categorial-data-techniques" id="toc-categorial-data-techniques" class="nav-link" data-scroll-target="#categorial-data-techniques">3.2 Categorial Data Techniques:</a></li>
  </ul></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">4. Model</a>
  <ul class="collapse">
  <li><a href="#create-the-quadratic-equation" id="toc-create-the-quadratic-equation" class="nav-link" data-scroll-target="#create-the-quadratic-equation">4.1 Create the Quadratic Equation</a></li>
  <li><a href="#quadratic-function-plotter" id="toc-quadratic-function-plotter" class="nav-link" data-scroll-target="#quadratic-function-plotter">4.2 Quadratic Function Plotter</a></li>
  </ul></li>
  <li><a href="#synthetic-data" id="toc-synthetic-data" class="nav-link" data-scroll-target="#synthetic-data">5. Synthetic Data</a>
  <ul class="collapse">
  <li><a href="#noise" id="toc-noise" class="nav-link" data-scroll-target="#noise">5.1 Noise</a></li>
  <li><a href="#sample-of-original-quadratic" id="toc-sample-of-original-quadratic" class="nav-link" data-scroll-target="#sample-of-original-quadratic">5.2 Sample of Original Quadratic</a></li>
  <li><a href="#add-gaussian-noise-to-sample-of-original-quadratic" id="toc-add-gaussian-noise-to-sample-of-original-quadratic" class="nav-link" data-scroll-target="#add-gaussian-noise-to-sample-of-original-quadratic">5.3 Add Gaussian Noise to Sample of Original Quadratic</a></li>
  <li><a href="#plot-quad-and-noisey-quad" id="toc-plot-quad-and-noisey-quad" class="nav-link" data-scroll-target="#plot-quad-and-noisey-quad">5.4 Plot Quad and Noisey Quad</a>
  <ul class="collapse">
  <li><a href="#dirty-version" id="toc-dirty-version" class="nav-link" data-scroll-target="#dirty-version">5.4.1 Dirty Version</a></li>
  <li><a href="#clean-version" id="toc-clean-version" class="nav-link" data-scroll-target="#clean-version">5.4.2 Clean Version</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#metrics" id="toc-metrics" class="nav-link" data-scroll-target="#metrics">6. Metrics</a>
  <ul class="collapse">
  <li><a href="#mean-absolute-error-mae" id="toc-mean-absolute-error-mae" class="nav-link" data-scroll-target="#mean-absolute-error-mae">6.1 Mean Absolute Error (MAE)</a></li>
  </ul></li>
  <li><a href="#dirty-version-1" id="toc-dirty-version-1" class="nav-link" data-scroll-target="#dirty-version-1">6.1.1 Dirty Version</a></li>
  <li><a href="#clean-version-1" id="toc-clean-version-1" class="nav-link" data-scroll-target="#clean-version-1">6.1.2 Clean Version</a></li>
  <li><a href="#plot-with-mae" id="toc-plot-with-mae" class="nav-link" data-scroll-target="#plot-with-mae">7. Plot with MAE</a></li>
  <li><a href="#gradient-descent" id="toc-gradient-descent" class="nav-link" data-scroll-target="#gradient-descent">8. Gradient Descent</a>
  <ul class="collapse">
  <li><a href="#mae-calculator" id="toc-mae-calculator" class="nav-link" data-scroll-target="#mae-calculator">8.1 MAE Calculator</a></li>
  <li><a href="#loss-function-without-requires_grad_" id="toc-loss-function-without-requires_grad_" class="nav-link" data-scroll-target="#loss-function-without-requires_grad_">8.2 Loss Function without <code>requires_grad_()</code></a></li>
  <li><a href="#apply-requires_grad_-method-to-input-tensor" id="toc-apply-requires_grad_-method-to-input-tensor" class="nav-link" data-scroll-target="#apply-requires_grad_-method-to-input-tensor">8.3 Apply <code>requires_grad_()</code> method to input tensor</a></li>
  <li><a href="#loss-function-with-requires_grad_" id="toc-loss-function-with-requires_grad_" class="nav-link" data-scroll-target="#loss-function-with-requires_grad_">8.4 Loss Function with <code>requires_grad_()</code></a></li>
  <li><a href="#apply-backward-to-a-loss-function-to-calculate-gradients-of-the-inputs-parameters" id="toc-apply-backward-to-a-loss-function-to-calculate-gradients-of-the-inputs-parameters" class="nav-link" data-scroll-target="#apply-backward-to-a-loss-function-to-calculate-gradients-of-the-inputs-parameters">8.5 Apply <code>backward()</code> to a Loss function to calculate gradients of the inputs parameters</a>
  <ul class="collapse">
  <li><a href="#tba-step-update-parameters" id="toc-tba-step-update-parameters" class="nav-link" data-scroll-target="#tba-step-update-parameters">2.4 TBA STEP UPDATE PARAMETERS</a></li>
  </ul></li>
  <li><a href="#simulate-data" id="toc-simulate-data" class="nav-link" data-scroll-target="#simulate-data">2. Simulate Data</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><img src="deep.jpg" class="img-fluid"></p>
<p>It’s time to dive into previously explored topics a bit more <strong>deeply</strong>. Time to try to understand what’s actually going on.</p>
<p>These posts help me trigger what kind of thought process I had at the time of learning the topic. It’s <strong>not be easily disgestable for other people 🗺️</strong> but feel free to read on.</p>
<p>Up til now, I’ve sped-run topics whilst not understanding much of the details.</p>
<p>I like to get the code running at least and produce results to expectation before getting in the weeds. At least I know the code works so I don’t end up heading towards doom 🌚.</p>
<p>In these deeper dives:</p>
<ul>
<li><p>Lets hope to do these concepts justice (I’ll try to get feedback from professionals at some point). Feel free to correct my understanding! (I’m sure some parts aren’t on the ball 👎🍙).</p></li>
<li><p>The concepts and math are brand new to me (or done a decade ago), these posts help me express things in my way, which is usually the very lay way. It is a pretty raw thoughts at each step of the concepts and ideas I’m trying to understand; Con-steps? Step-deas? (Sorry ❄️).</p></li>
<li><p>Also, without writing them down, I’ll end up forgetting most of how and what I thought to conceive these concepts (I need to improve my vocabulary), i.e.&nbsp;it will be like these thoughts had never had happened (loss and irretrievable from the black-hole that is my mind ⚫).</p></li>
</ul>
<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<section id="the-mission" class="level2">
<h2 class="anchored" data-anchor-id="the-mission">1.1 The Mission</h2>
<p><img src="mission.jpg" class="img-fluid"></p>
<p><strong>[Mission]</strong>:</p>
<ul>
<li>Create a <code>model</code> that takes in some <code>inputs</code> and provides a reasonble <code>output</code> (prediction).</li>
</ul>
<p><strong>[Method]</strong>:</p>
<ul>
<li>A <code>mathematical function</code> is a form of a model:
<ul>
<li>takes in inputs <code>x1, x2, ...</code> and</li>
<li><code>transforms</code> it into a single output <code>y = F(x1, x2, ...)</code>.</li>
</ul></li>
</ul>
<p>This seems like a good appraoch to tackle the mission.</p>
</section>
<section id="the-mathematical-model" class="level2">
<h2 class="anchored" data-anchor-id="the-mathematical-model">1.2 The Mathematical Model</h2>
<p><code>Create a Linear Model</code> (or mathematical function) given some <code>(real world) data</code> (data that represents something we want to predict given similar input) in the form <span class="math display">\[y = a_1x_1 + a_2x_2 + ... a_nx_n\]</span> It is called <code>Linear</code> because our inputs <code>x</code> are of degree 1.</p>
<ul>
<li>Each <code>inputs</code> (<code>x1, x2, ..., xn</code>) is multiplied by their corresponding <code>coefficients</code> or <code>parameters</code> (<code>a1, a2, ..., an</code>), i.e.: <span class="math display">\[a_1x_1 + a_2x_2 + ...\]</span>
<ul>
<li>The <code>inputs</code> variables <code>x</code>’s are like features or characteristics of our model.</li>
<li>the <code>coefficients</code> (known as <code>parameters</code>) in machine learning talk, scale the features/inputs. By scaling the inputs, it’s like finding out which input/feature matters more or not, in determining the output.</li>
</ul></li>
<li>The output <code>y</code> (known as <code>predictions</code>) is calculated by <code>summing all the scaled parameters</code> together: <code>a1x1 + a2x2 + ...</code>: <span class="math display">\[F(x) = y = a_1x_1 + a_2x_2 + ... + a_nx_n\]</span></li>
</ul>
<section id="laymens-mathematical-model" class="level3">
<h3 class="anchored" data-anchor-id="laymens-mathematical-model">1.2.1 Laymens (mathematical model):</h3>
<ul>
<li>If a coefficient <span class="math inline">\(a_1, a_2 ...\)</span> is <strong>almost zero</strong>, it’s like saying it does not impact the prediction value (remember we are adding up scaled versions of inputs to calculate the output / prediction). Then thats like saying perhaps this particualr parameter is an unimportant variable (or feature)!
<ul>
<li>Perhaps we can get rid of it altogether?</li>
<li>Less variables, less calculations, less overhead (and less work!) and a more simple model without losing significant predictive power.</li>
</ul></li>
<li>If it has a large coefficient, then it would impact the overall sum, hence prediction. Probably shouldnt disregard this parameter.</li>
</ul>
</section>
</section>
<section id="mathematical-models-examples" class="level2">
<h2 class="anchored" data-anchor-id="mathematical-models-examples">1.3 Mathematical models examples</h2>
<p>Two simple examples (single input <code>x</code> and a single output <code>y</code>) can be visualised on the <code>2D-plane</code>:</p>
<ul>
<li>A <code>straight line</code> where input <code>x</code> is the horizontal-axis and output: <code>F(x)</code> and <code>y</code> is on the vertical-axis is with the formula we all know and love: <span class="math display">\[ F(x) = mx + b \]</span></li>
</ul>
<p>And similarly,</p>
<ul>
<li>A <code>quadratic line</code> is: <span class="math display">\[F(x) = ax^2 + bx + c\]</span></li>
</ul>
<p><strong>Note</strong>: <strong><em>Our model should <code>generalise a mathematical function</code> (or find out the core characteristics and relationships ) given our set of data, so once we know that, we can predict unseen data with similar traits.</em></strong></p>
<ul>
<li><p>For a quadratic equation, what combination of <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span> and <span class="math inline">\(c\)</span> will help us predict closely the value we want given some random <span class="math inline">\(x\)</span></p></li>
<li><p>How about all of <span class="math inline">\(x\)</span> as we want and have good predictions all of them on average <span class="math inline">\(x\)</span>? That’s what we are trying to do!</p></li>
</ul>
</section>
</section>
<section id="data-preparation" class="level1">
<h1>2. Data Preparation</h1>
<section id="choose-a-model" class="level2">
<h2 class="anchored" data-anchor-id="choose-a-model">2.1 Choose a Model</h2>
<p>Why are we talking about models where the title is <code>Data Preparation</code>?</p>
<p>As seen in our <code>Mission</code> statement, we wish to create a model to solve problems. In my mind, this means we should have some mental model of what we are trying to solve, and then we decide what data that goes into the model.</p>
<p>If we just have some data without a sense of how it fits into a particular model in mind, how will know what to do with data, whether the data is relevant, its just a piece of data.</p>
<p>Once we established our first model (we could change it later) then we can process our data to enter the model.</p>
<section id="quadratic-equation-example" class="level3">
<h3 class="anchored" data-anchor-id="quadratic-equation-example">2.1.1 Quadratic Equation Example</h3>
<ul>
<li>Assume a quadratic equation: <code>F(x) = ax^2 + bx + c</code> can help us model some real world phenomena (e.g.&nbsp;throwing a ball or driving then stopping).</li>
</ul>
<p><img src="quad_real_world.jpg" class="img-fluid"></p>
</section>
</section>
<section id="make-predictions-with-our-model" class="level2">
<h2 class="anchored" data-anchor-id="make-predictions-with-our-model">2.2 Make Predictions with our Model</h2>
<p>Great! We have our model, lets start making predictions!</p>
<p>Not quite. There are alot of missing components that has not been decided in our equation.</p>
<p>Also <strong><em>what does it mean to even make a prediction and how do we do it</em></strong>?</p>
<ul>
<li><p>In our <code>mathematical model</code> context, it’s as simple as plugging in the different input values (<code>x</code>) and their coefficients (<code>a,b,c</code>) to our quadaratic equation (<code>F(x) = ax^2 + bx + c</code>) to see what output value (<code>y</code>) we get.</p></li>
<li><p>In other words, calculate the <code>F(x)</code> (predictions) by using different combinations of our inputs <code>x</code> and parameters <code>a,b,c</code> with the equation <code>F(x) = ax^2 + bx + c</code>. Simple!</p></li>
</ul>
<p>But what combinations <code>a,b,c and x</code> do we to use? - Surely not random? Well kind of yes but also no.</p>
<p>Note: input variables are known as <code>features</code> and coefficients are known as <code>parameters</code>. So, I’ll use them interchangeably.</p>
<p><strong><em>[QUESTION]</em></strong>: - To make useful and relevant predictions, is there some <strong>systematic way</strong> to decide what <strong><em>starting</em></strong> <strong><em><code>parameters</code>(<span class="math inline">\(a, b, c\)</span>)</em></strong> and <strong><em><code>features</code>(<span class="math inline">\(x_1, x_2\)</span>)</em></strong> to use?</p>
</section>
<section id="starting-inputs-variables-x_1-x_2-...-x_n" class="level2">
<h2 class="anchored" data-anchor-id="starting-inputs-variables-x_1-x_2-...-x_n">2.3 <strong><em>Starting</em></strong> Inputs Variables <span class="math inline">\(x_1, x_2, ... , x_n\)</span></h2>
<p>The question is <span class="math inline">\(x\)</span>’s do we start with?</p>
<p>Lets discuss a model that is a little more complex than a line on a 2-D plane.</p>
<p>Say we want a predictive model that guesses whether a passenger on the Titanic: - <strong>Survived</strong> and - <strong>Did not Survive</strong></p>
<section id="good-starting-inputs-variables" class="level3">
<h3 class="anchored" data-anchor-id="good-starting-inputs-variables">2.3.1 Good Starting Inputs Variables</h3>
<ul>
<li>A <code>good set</code> of input variables would be data on actual passengers of the titanic and information on whether they survived or not.</li>
<li>The learning model would learn about all the characteristics of these passengers and then adjust the parameters and scale towards characteristics that matter and and vice version on passengers and their survivability.</li>
<li>Through the training process, the model may find some characteristics to be irrelevant (perhaps ear length), but that is not the focus of this part of the process. This part of the process is where to start.</li>
</ul>
</section>
<section id="bad-starting-inputs" class="level3">
<h3 class="anchored" data-anchor-id="bad-starting-inputs">2.3.2 Bad Starting Inputs</h3>
<p>An <code>even worse</code> set of inputs (moving towards the bad <code>validation set</code> territory, more on this later). Data from unrelated sources (sorry to state the obvious) such as:<br>
- the cohort of 2015 Applied Finance Graduates from Macquarie University, Sydney,<br>
- a group people picked at random off streets of Binh Thanh Saigon, Vietnam,<br>
- a group of online matches from a popular dating app obtained by a user.<br>
These groups technically surivived the Titanic so the model will say all their characteristics of everyone are useful, which isnt a great predictor (it’ll predict being born after the Titanic sunk gives you a 100% chance of surviving the Titanic 🤭)</p>
</section>
</section>
<section id="starting-coefficients-x_1-x_2-...-x_n" class="level2">
<h2 class="anchored" data-anchor-id="starting-coefficients-x_1-x_2-...-x_n">2.4 <strong><em>Starting</em></strong> Coefficients <span class="math inline">\(x_1, x_2, ... , x_n\)</span></h2>
<p>I heard determeting starting coefficients is <strong><em>more of an art than a science</em></strong> (Lets assume later there are some cool algorithms that give us a hand in the future).</p>
<section id="about-zero" class="level3">
<h3 class="anchored" data-anchor-id="about-zero">2.4.1 About Zero</h3>
<p>It would make sense that initially <strong>input dominate parameters</strong> (input values are large relative to their coefficients) and then they’re scaled by a <strong>parameter</strong> according to importance through the neural network.<br>
- This means, start with <strong>relatively low value parameters</strong> (to it’s input variables) and let these coefficients adjust (<code>learn</code> through <code>gradient descent</code>) to larger values, whether positive or negative.<br>
- In other words start with coefficients <strong>about zero</strong>.</p>
</section>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">2.4.1.1 Example</h3>
<ul>
<li>Say we play a game where I tell you to choose a starting value and take count by 1 towards my guess and you want to choose a starting value to minimise the count on average.<br>
</li>
<li>And I tell you my guess is always random and between <code>-50 and 50</code>.<br>
</li>
<li>You’d probably pick zero because its common sense! (I hope it is)<br>
</li>
<li>It’s kind of same in our model, except we dont pick zero itself because it ruins the math (explain later).</li>
</ul>
</section>
<section id="titanic" class="level3">
<h3 class="anchored" data-anchor-id="titanic">2.4.2 Titanic</h3>
<p>Lets assume we have a parameters should be relatively large and positive (for e.g.&nbsp;being a female or child in first class on the Titanic is probably two good parameters for survivability).<br>
- If the parameter starts off large and negative then this causes the model to take alot of iterations to learn and adjust the parameter to be positive. And vice versa.<br>
- So if we set all near zero, it will simply take <code>less time on average</code> for most models for each parameter to get to whether they need to go (<code>optimisation?</code>) considering we don’t know what parameters matter or not, so its random for us, ie, it can be positive or negative.</p>
</section>
<section id="preset-coefficients-and-pre-trained-models" class="level3">
<h3 class="anchored" data-anchor-id="preset-coefficients-and-pre-trained-models">2.4.3 Preset Coefficients and Pre-trained Models</h3>
<p><code>Setting some coefficients initially</code> (rather than using all random coefficients) and then training the model to the training set, this is actually called <code>learning with a pre-trained model</code> (not set by us). - This pre-trained model has already been run and completed by someone else and we are teaching the model learn about our data on top of its knowledge.<br>
- Most of what I’ll be initially doing is <code>Building a Learner from a Pre-trained Model</code>. In the future, I hope to learn to build the Pre-Trained models from scratch, if its a useful endeavour?<br>
- Popular examples of pre-trained models are <code>ResNet50</code>, which are trained on (millions of) pictures with 50 layers deep neural network.</p>
</section>
<section id="isnt-it-all-relative" class="level3">
<h3 class="anchored" data-anchor-id="isnt-it-all-relative">2.4.4 Isn’t it all relative?</h3>
<p>Doesn’t a coefficients <strong>relativeness</strong> depend on the actual value of its <strong>corresponding input parameter</strong>. - So shouldn’t the starting coefficient be set <strong>relative to its corresponding starting input parameter</strong>, and - Not just an <code>arbitrary range of -0.5 to 0.5</code>?</p>
<p>Also, input variables can <strong>range drastically</strong> <strong>within itself</strong> and <strong>relative to other variables</strong>! For example: - <code>age</code> could be range <code>from 1 to 130</code> years old<br>
- <code>Amount of money fundraised or donated</code> by people could range <code>0 to billions</code><br>
- <code>Lenght of the petals of a plum flower</code> could range <code>0.1 mm to 40 mm</code>.<br>
- <code>x-values</code> of any line function could be negative <span class="math inline">\(\infty\)</span> to positive <span class="math inline">\(\infty\)</span> (ngl I wanted to use the <span class="math inline">\(\infty\)</span> sign for once in my life ♾️)</p>
<p>With all these unaswered questions…</p>
<p><strong><em>Does it still make sense to just choose coefficients about zero? (-0.5 to 0.5)?</em></strong></p>
<p>Yes, because of normalisation.</p>
</section>
</section>
<section id="normalisation" class="level2">
<h2 class="anchored" data-anchor-id="normalisation">3. Normalisation</h2>
<p><code>Data normalization</code> (in ML) refers to the process of <code>scaling</code> and <code>standardizing</code> the features of a dataset. - This ensures all <code>features contribute equally to the learning process</code> - To avoid issues related to <code>different scales and units</code> in the input data.</p>
<p>Are there different techniques for <code>numeric</code> versis <code>categorical</code> data? Absolutely.</p>
</section>
<section id="numerical-data-techniques" class="level2">
<h2 class="anchored" data-anchor-id="numerical-data-techniques">3.1 Numerical Data Techniques:</h2>
<p><strong><em>Min-Max Scaling</em></strong>: - Scales the data to a specific range, often [0, 1].</p>
<p><strong><em>Standardization (Z-score normalization)</em></strong>: - Scales the data to have a mean of 0 and a standard deviation of 1.</p>
<p><strong><em>Robust Scaling</em></strong>: - Uses the median and interquartile range (IQR) instead of the mean and standard deviation (Similar to standardization). Robust Scaling is less sensitive to outliers than standardization.</p>
<p><strong><em>Log Transformation</em></strong>: - Applied when the data is skewed, and you want to reduce the impact of large values.</p>
<p><strong><em>Normalization in Neural Networks</em></strong>: - Normalize input features to zero mean and unit variance. Batch normalization layers can also be used within the network to normalize the activations of hidden layers during training.</p>
<section id="problem-with-normalised-data" class="level3">
<h3 class="anchored" data-anchor-id="problem-with-normalised-data">3.1.1 Problem with Normalised Data</h3>
<p>During gradient descent, the algorithm updates the model weights based on the direction of the steepest descent in the cost function (error).</p>
<p>For simple linear regression model to predict housing prices based on two features: square footage (ft²) and number of bedrooms: - the large values of square footage will have a <code>much stronger influence</code> on the <code>gradient calculation</code> compared to the number of bedrooms. - This can lead the algorithm to prioritize changes based on square footage, potentially neglecting the impact of bedrooms on price.</p>
</section>
<section id="benefits-to-gradient-descent" class="level3">
<h3 class="anchored" data-anchor-id="benefits-to-gradient-descent">3.1.2 Benefits to Gradient Descent</h3>
<p>Gradient descent is an iterative optimization algorithm commonly used in machine learning for training models. It aims to find the minimum of a cost function by adjusting model parameters iteratively.</p>
<p><strong><em>Gradient Descent Sensitivity to Scale</em></strong>: - The scale of the input features directly influences the scale of the gradients. Features with larger scales can dominate the learning process and cause the algorithm to converge slowly or not converge at all.</p>
<p><strong><em>Equalizing the Influence of Features</em></strong>: - Normalizing data ensures that all features have a similar scale, <code>preventing the algorithm from being biased</code> towards features with larger magnitudes. - This equalization is particularly important when features have different units or scales, as it allows each feature to contribute proportionally to the model’s parameter updates during training.</p>
<p><strong><em>Faster Convergence</em></strong>: - Normalization often leads to <code>faster convergence</code> during training. With well-scaled features, the algorithm can take more substantial steps towards the minimum of the cost function, <code>reducing the number of iterations</code> needed for convergence.</p>
<p><strong><em>Improved Numerical Stability</em></strong>: - Normalization enhances the numerical stability of the optimization process. It helps prevent issues like <code>vanishing or exploding gradients</code>, which can occur when working with features of vastly different magnitudes.</p>
<p><strong><em>Regularization Considerations</em></strong>: - Some regularization techniques, such as L1 and L2 regularization, are sensitive to the scale of features. Normalizing features ensures that regularization terms act uniformly across all features, leading to a fair and effective regularization.</p>
</section>
</section>
<section id="categorial-data-techniques" class="level2">
<h2 class="anchored" data-anchor-id="categorial-data-techniques">3.2 Categorial Data Techniques:</h2>
<p>Categorical data itself cannot be normalized in the same way numerical data is</p>
<p><strong><em>Dummy Variables or (One-Hot Encoding)</em></strong>: - Create a new binary feature for each category within the original categorical variable. - Each new feature gets a value of 1 if the data point belongs to that category, and 0 otherwise. - This is a more robust approach.</p>
<p><strong><em>Label Encoding</em></strong>: - Assign a unique numerical value (integer) to each category. - For example, “Blue” = 1, “Brown” = 2, and “Green” = 3 for eye color categories.</p>
</section>
</section>
<section id="model" class="level1">
<h1>4. Model</h1>
<p>Create data based on the a quadratic equation and add some noise to it simulate real world</p>
<section id="create-the-quadratic-equation" class="level2">
<h2 class="anchored" data-anchor-id="create-the-quadratic-equation">4.1 Create the Quadratic Equation</h2>
<p>From the general equation <span class="math display">\[ F(a,b,c,x) = ax^2 + b + c \]</span> Simulate data from <span class="math display">\[ F(3,2,1,x) = 3x^2 + 2x + 1 \]</span> where <span class="math inline">\(a = 3, b = 2, c = 1\)</span></p>
<div id="cell-27" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> quad_fn(a,b,c,x): <span class="cf">return</span> a<span class="op">*</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> b<span class="op">*</span>x <span class="op">+</span> c <span class="co">#</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> custom_quad_fn(a,b,c): <span class="cf">return</span> partial(quad_fn, a,b,c) <span class="co"># partial fixes a b c</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>quad_og_fn <span class="op">=</span> custom_quad_fn(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>) <span class="co"># og function</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># quad_111(1) # quadfn f(1): 1(1)^2 + 1(1) + 1 = 1 + 1 + 1 = 3 </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># quad_222(2) # quadfn f(2): 1(2)^2 + 1(2) + 1 = 4 + 2 + 1 = 7</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># quad_333(3) # quadfn f(3): 1(3)^2 + 1(3) + 1 = 9 + 3 + 1 = 13 </span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>quad_og_fn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="quadratic-function-plotter" class="level2">
<h2 class="anchored" data-anchor-id="quadratic-function-plotter">4.2 Quadratic Function Plotter</h2>
<p><strong><em>Inputs</em></strong>: - custom_quad_fn(a,b,c) - <em>[partial_fn]</em> - x-limits (min, max) - [<em>numeric</em>] - colour [<em>str</em>] - y-limit -[<em>numeric</em>]</p>
<p><strong><em>Outputs</em></strong>: - <code>x-values - [tensor]</code>: creates 2-D tensor of x-values (not sure why we need a 2D yet) but its done by applying <code>[:,None]</code> to a 1D-Tensor - <code>f(x) - [tensor]</code>: output of custom_quad_fn based on x-values (tensor)</p>
<div id="cell-29" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch <span class="im">import</span> torch</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipywidgets <span class="im">import</span> interact</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-30" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="at">@interact</span>(a<span class="op">=</span><span class="fl">1.1</span>,b<span class="op">=</span><span class="fl">1.1</span>,c<span class="op">=</span><span class="fl">1.1</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> quad_plotter(a,b,c):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    quad_abc_fn <span class="op">=</span> custom_quad_fn(a,b,c)    <span class="co"># 1. create quad abc</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    xs <span class="op">=</span> torch.linspace(<span class="op">-</span><span class="fl">2.1</span>, <span class="fl">2.1</span>, steps<span class="op">=</span><span class="dv">100</span>)     <span class="co"># 2. create xs</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    ys <span class="op">=</span> quad_abc_fn(xs)   <span class="co"># 3. create ys</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    plt.ylim((<span class="op">-</span><span class="dv">3</span>,<span class="dv">15</span>))<span class="co"># 4. set limits</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    plt.xlim((<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    plt.plot(xs, ys, color<span class="op">=</span><span class="st">'r'</span>)    <span class="co">#5. plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="synthetic-data" class="level1">
<h1>5. Synthetic Data</h1>
<p>Lets create some Gaussian Noise and add it out Quadratic Function</p>
<div id="cell-32" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> noise(input_tnsr_1D, std_dev):<span class="co"># Creates an N(0,std_dev) of same shape as input_tnsr</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    np.random.seed(<span class="dv">42</span>)     </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> torch.tensor(np.random.normal(scale<span class="op">=</span>std_dev, size <span class="op">=</span> input_tnsr_1D.shape))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="noise" class="level2">
<h2 class="anchored" data-anchor-id="noise">5.1 Noise</h2>
<p>So why is only <code>scaling</code> our data by this <code>gaussian noise</code> not enough? That is, why do you need to have an <code>addititive</code> component?</p>
<ul>
<li>By definition, large input values are always relatively larger than smaller input values, thus our edges of the original quadratic function (values further away from zero), will have greater variation than those about zero. By multiplying evey point by random guassian scaler, the edges will be larger on avearge.
<ul>
<li>This means there is unneccesary larger descrepancies about our original function due to the nature of our function, and that isnt what we are after.</li>
<li>We want random data distrbuted normally about our original data, regardless of the value.</li>
<li>It makes most sense to have a relatively smaller scaling/multiplicative factor and have some uniform randomly distributed <code>additive</code> component.</li>
</ul></li>
</ul>
<p>Controlling the Impact on Signal Strength:</p>
<p><strong><em>Additive noise</em></strong>: This can overwhelm weaker signals by adding a constant amount of noise, making them difficult to recover or analyze.</p>
<p><strong><em>Multiplicative noise</em></strong>: This can preserve the relative strengths of different signals in the data. Even if a weak signal is amplified or attenuated by a small factor due to the noise, it remains proportionally weaker compared to stronger signals. This can be crucial for tasks like signal separation or classification where maintaining relative signal strengths is important.</p>
</section>
<section id="sample-of-original-quadratic" class="level2">
<h2 class="anchored" data-anchor-id="sample-of-original-quadratic">5.2 Sample of Original Quadratic</h2>
<div id="cell-35" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>xs_og_10_vals_tnsr <span class="op">=</span> torch.linspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, steps <span class="op">=</span> <span class="dv">20</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ys_og_10_vals_tnsr <span class="op">=</span> quad_og_fn(xs_og_10_vals_tnsr) <span class="co"># 10 og data points</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-gaussian-noise-to-sample-of-original-quadratic" class="level2">
<h2 class="anchored" data-anchor-id="add-gaussian-noise-to-sample-of-original-quadratic">5.3 Add Gaussian Noise to Sample of Original Quadratic</h2>
<div id="cell-37" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 og + noise data points</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. get [10_og_data_points]</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ys_og_10_vals_tnsr</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2a. get random scaler [10_vals_tnrs]:</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>noise_scaler_10_vals_tnsr <span class="op">=</span> noise(ys_og_10_vals_tnsr, <span class="fl">0.15</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>noise_adder_10_vals_tnsr <span class="op">=</span> noise(ys_og_10_vals_tnsr, <span class="fl">1.5</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># noise_scaler_10_vals_tnsr</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2b. apply random scaler to og data</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>scalars_10_vals_tnsr <span class="op">=</span> noise_scaler_10_vals_tnsr <span class="op">*</span> ys_og_10_vals_tnsr </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>ys_scaled_og_10_vals_tnsr <span class="op">=</span> ys_og_10_vals_tnsr <span class="op">+</span> scalars_10_vals_tnsr</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3a. get random_additive [10_vals_tnrs]: </span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>ys_syn_data_og_n_noise_10_vals_tnsr <span class="op">=</span> ys_scaled_og_10_vals_tnsr <span class="op">+</span> noise_adder_10_vals_tnsr </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. result: this is [synthetic_10_data_points]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-quad-and-noisey-quad" class="level2">
<h2 class="anchored" data-anchor-id="plot-quad-and-noisey-quad">5.4 Plot Quad and Noisey Quad</h2>
<section id="dirty-version" class="level3">
<h3 class="anchored" data-anchor-id="dirty-version">5.4.1 Dirty Version</h3>
<div id="cell-39" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 og + noise data points</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. get [10_og_data_points]</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>ys_og_10_vals_tnsr</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2a. get random scaler [10_vals_tnrs]:</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>noise_scaler_10_vals_tnsr <span class="op">=</span> noise(ys_og_10_vals_tnsr, <span class="fl">0.15</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>noise_adder_10_vals_tnsr <span class="op">=</span> noise(ys_og_10_vals_tnsr, <span class="fl">1.5</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># noise_scaler_10_vals_tnsr</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2b. apply random scaler to og data</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>scalars_10_vals_tnsr <span class="op">=</span> noise_scaler_10_vals_tnsr <span class="op">*</span> ys_og_10_vals_tnsr </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>ys_scaled_og_10_vals_tnsr <span class="op">=</span> ys_og_10_vals_tnsr <span class="op">+</span> scalars_10_vals_tnsr</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3a. get random_additive [10_vals_tnrs]: </span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>ys_syn_data_og_n_noise_10_vals_tnsr <span class="op">=</span> ys_scaled_og_10_vals_tnsr <span class="op">+</span> noise_adder_10_vals_tnsr </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. result: this is [synthetic_10_data_points]</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># from ipywidgets import interact</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># @interact(a=1.1,b=1.1,c=1.1)</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>plt.scatter(xs_og_10_vals_tnsr, ys_syn_data_og_n_noise_10_vals_tnsr)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span><span class="fl">1.1</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>b<span class="op">=</span><span class="fl">1.1</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>c<span class="op">=</span><span class="fl">1.1</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>quad_plotter(a,b,c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="clean-version" class="level3">
<h3 class="anchored" data-anchor-id="clean-version">5.4.2 Clean Version</h3>
<div id="cell-41" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="at">@interact</span>(a<span class="op">=</span><span class="fl">1.1</span>,b<span class="op">=</span><span class="fl">1.1</span>,c<span class="op">=</span><span class="fl">1.1</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> quad_scatter_plotter(a,b,c):</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    plt.scatter(xs_og_10_vals_tnsr, ys_syn_data_og_n_noise_10_vals_tnsr)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    quad_plotter(a,b,c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="metrics" class="level1">
<h1>6. Metrics</h1>
<p>It’ll be great if we can have some metrix to measure how close our plot is to the noisey data.</p>
<p>By measuring the distance between our prediction (red line) and the data (red dots), and sum all the differences then we have some measure of our accuracy. There are two popular metrics in Machine Learning:<br>
- Mean Absolute Error (MAE) - Mean Squared Error (MSE).</p>
<p><strong>Note</strong>: We didn’t simply take the differences because our predictions <strong><em>will cancel out</em></strong> as our the data lies above and below our predictions.</p>
<section id="mean-absolute-error-mae" class="level2">
<h2 class="anchored" data-anchor-id="mean-absolute-error-mae">6.1 Mean Absolute Error (MAE)</h2>
<ol type="1">
<li>Calculate the Differences between each Prediction and the Data point</li>
<li>Apply Absolute function (or square if we’re doing MSE)</li>
<li>Take the Average</li>
</ol>
</section>
</section>
<section id="dirty-version-1" class="level1">
<h1>6.1.1 Dirty Version</h1>
<div id="cell-45" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. get 10 synthethic data points</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>ys_syn_data_og_n_noise_10_vals_tnsr</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. get 10 predictions</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span><span class="fl">1.1</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>b<span class="op">=</span><span class="fl">1.1</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>c<span class="op">=</span><span class="fl">1.1</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>curr_quad_abc_predictive_model <span class="op">=</span> custom_quad_fn(a,b,c)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>ys_curr_quad_predictions_tnsr <span class="op">=</span> curr_quad_abc_predictive_model(xs_og_10_vals_tnsr)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>diff_preds_vs_syn_data_tnsr <span class="op">=</span> ys_curr_quad_predictions_tnsr<span class="op">-</span>ys_syn_data_og_n_noise_10_vals_tnsr</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>abs_diff_preds_vs_syn_data_tnsr <span class="op">=</span>torch.<span class="bu">abs</span>(diff_preds_vs_syn_data_tnsr)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>mae_calc <span class="op">=</span> abs_diff_preds_vs_syn_data_tnsr.mean()</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>mae_calc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="clean-version-1" class="level1">
<h1>6.1.2 Clean Version</h1>
<div id="cell-47" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>curr_quad_abc_predictive_model <span class="op">=</span> custom_quad_fn(a,b,c)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>ys_curr_quad_predictions_tnsr <span class="op">=</span> curr_quad_abc_predictive_model(xs_og_10_vals_tnsr)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> custom_mae(preds, actual):</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    diff_preds_vs_syn_data_tnsr <span class="op">=</span> preds<span class="op">-</span>actual</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    abs_diff_preds_vs_syn_data_tnsr <span class="op">=</span>torch.<span class="bu">abs</span>(diff_preds_vs_syn_data_tnsr)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> abs_diff_preds_vs_syn_data_tnsr.mean()</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> loss</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>custom_mae(ys_curr_quad_predictions_tnsr,ys_syn_data_og_n_noise_10_vals_tnsr)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  3. mae </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-with-mae" class="level1">
<h1>7. Plot with MAE</h1>
<div id="cell-49" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="at">@interact</span>(a<span class="op">=</span><span class="fl">1.1</span>,b<span class="op">=</span><span class="fl">1.1</span>,c<span class="op">=</span><span class="fl">1.1</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> quad_scatter_plotter(a,b,c):</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    curr_quad_abc_predictive_model <span class="op">=</span> custom_quad_fn(a,b,c)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    ys_curr_quad_predictions_tnsr <span class="op">=</span> curr_quad_abc_predictive_model(xs_og_10_vals_tnsr)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> custom_mae(ys_curr_quad_predictions_tnsr,ys_syn_data_og_n_noise_10_vals_tnsr)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"mae: </span><span class="sc">{</span>loss<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    plt.scatter(xs_og_10_vals_tnsr, ys_syn_data_og_n_noise_10_vals_tnsr)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    quad_plotter(a,b,c)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gradient-descent" class="level1">
<h1>8. Gradient Descent</h1>
<section id="mae-calculator" class="level2">
<h2 class="anchored" data-anchor-id="mae-calculator">8.1 MAE Calculator</h2>
<p>Create a function that accepts parameters (of a quadratic) and calculates the MAE</p>
<div id="cell-52" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> loss_function_mae(param_tnsr):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    pred_model <span class="op">=</span> custom_quad_fn(<span class="op">*</span>param_tnsr)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    preds <span class="op">=</span> pred_model(xs_og_10_vals_tnsr)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> custom_mae(preds,ys_syn_data_og_n_noise_10_vals_tnsr)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> loss</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span><span class="fl">1.1</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>b<span class="op">=</span><span class="fl">1.1</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>c<span class="op">=</span><span class="fl">1.1</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>abc_tsr <span class="op">=</span> torch.tensor([a,b,c])</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>abc_tsr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loss-function-without-requires_grad_" class="level2">
<h2 class="anchored" data-anchor-id="loss-function-without-requires_grad_">8.2 Loss Function without <code>requires_grad_()</code></h2>
<div id="cell-54" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># abc_tnsr</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># loss_function_mae([1.1,1.1,1.1])</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>loss_function_mae(abc_tsr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="apply-requires_grad_-method-to-input-tensor" class="level2">
<h2 class="anchored" data-anchor-id="apply-requires_grad_-method-to-input-tensor">8.3 Apply <code>requires_grad_()</code> method to input tensor</h2>
<p>By calling this method on this tensor, each time this tensor is used in function, the gradients are calculated.</p>
<div id="cell-56" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>abc_tsr.requires_grad_()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loss-function-with-requires_grad_" class="level2">
<h2 class="anchored" data-anchor-id="loss-function-with-requires_grad_">8.4 Loss Function with <code>requires_grad_()</code></h2>
<p><code>abc_tnsr</code> has been called and its gradients can be calculuated.</p>
<div id="cell-58" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> loss_function_mae(abc_tsr)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="apply-backward-to-a-loss-function-to-calculate-gradients-of-the-inputs-parameters" class="level2">
<h2 class="anchored" data-anchor-id="apply-backward-to-a-loss-function-to-calculate-gradients-of-the-inputs-parameters">8.5 Apply <code>backward()</code> to a Loss function to calculate gradients of the inputs parameters</h2>
<p><code>.backward()</code> is called on and its attrbiute <code>.grad</code> is populated with gradients related to the loss</p>
<div id="cell-60" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>loss.backward()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-61" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>abc_tsr.grad</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-62" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. get tensor abc_tnsr</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. requires_grad_()</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># loop</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. with torch.no_grad():  [a,b,c]</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. calc gradients:        </span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-63" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    abc_tsr <span class="op">-=</span> abc_tsr.grad<span class="op">*</span><span class="fl">0.01</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> loss_function_mae(abc_tsr)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>loss    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-65" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>        abc_tnsr <span class="op">-=</span> abc_tnsr.grad<span class="op">*</span><span class="fl">0.01</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> loss_function_mae(abc_tnsr)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>loss<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="tba-step-update-parameters" class="level3">
<h3 class="anchored" data-anchor-id="tba-step-update-parameters">2.4 TBA STEP UPDATE PARAMETERS</h3>
<ul>
<li><code>updating parameters</code> to
<ul>
<li><code>improve accuracy</code> of our predictions (i.e.&nbsp;decrease difference between our predictions and data)</li>
<li><code>do it automatically</code>: the art of improving our model or <code>learning</code> is called <code>gradient descent</code>.<br>
</li>
</ul></li>
<li><code>neural network</code>: Once the model is accuracy we are happy with, this is our <code>neural network</code>.</li>
</ul>
<p>Quite simple really?</p>
</section>
</section>
<section id="simulate-data" class="level2">
<h2 class="anchored" data-anchor-id="simulate-data">2. Simulate Data</h2>
<p>Simulate content</p>
<div id="cell-69" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np, torch</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> noise(x, scale): <span class="cf">return</span> np.random.normal(scale<span class="op">=</span>scale, size<span class="op">=</span>x.shape)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_noise(x, mult, add): <span class="cf">return</span> x <span class="op">*</span> (<span class="dv">1</span><span class="op">+</span>noise(x,mult)) <span class="op">+</span> noise(x,add)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>actual_x_values_tsr <span class="op">=</span> torch.linspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, steps<span class="op">=</span><span class="dv">20</span>)[:,<span class="va">None</span>] <span class="co"># simulate 20 actual x-values + shape to 2D tensor</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> actual_function(x): <span class="cf">return</span> <span class="dv">3</span><span class="op">*</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>x <span class="op">+</span> <span class="dv">1</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># In reality we don't have a real function like this to use, </span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># however we use this + add noise, which simulates real data</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co"># then we try to model this noisey data</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>actual_y_values_unrealistic_tsr <span class="op">=</span> actual_function(actual_x_values_tsr)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a> <span class="co"># actual y-values of funtion we use to find</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">#  but again, these values are not realistic because they're based on the real function - something that doenst exist in real life,</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># its like having the exact function that determines whether a photo is a cat or not</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co"># we can only approximate functions and its parameters</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># in real world, data has noise,</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co"># introduce data to these unrealistic real values to product realistic actual values</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co"># okay so why dont we need to add noise to actual_x_values? its any input is realistic/real world</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co"># any photo is can be asked 'is it a cat?'</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># any passenger with any characters can be asked 'did the passenger survive?</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>actual_y_values_realistic_tsr <span class="op">=</span> add_noise(actual_y_values_unrealistic_tsr, <span class="fl">0.15</span>, <span class="fl">1.5</span>) <span class="co"># use actualy y-values + add noise - to create simulated real data </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-70" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#now that we have a set of (actual realistic) 'data'</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. try 'model' it with a quadratic equation </span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. create loss function - mean absolute error - difference between each point of actual y vs predicted y at each x, find difference and then absolute</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-71" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># actual_x_values[:5],actual_y_values_realistic[:5]</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Create quad function with parameters</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> quad_fn(a,b,c,x): <span class="cf">return</span> a<span class="op">*</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> b<span class="op">*</span>x <span class="op">+</span> c</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>y_a1_b1_c1_x1 <span class="op">=</span> quad_fn(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>y_a1_b1_c1_x1  <span class="co"># 3 = (1*1^2) + (1*1) + (1) = 1+1+1</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>y_a1_b1_c1_x2 <span class="op">=</span> quad_fn(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>y_a1_b1_c1_x2  <span class="co"># 7 = (1*2^2) + (2*1) + (2) = 4+2+1</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Its quite cumbersome to put a new x-value through the function, to get a corresponding predicted y-value</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ideally we can provide a list of xs to get a list of predicted ys (x-tensor -&gt; f -&gt; y-tensor)</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># and also the coefficients are parameterised</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mk_quad_fn(a,b,c): <span class="cf">return</span> partial(quad_fn,a,b,c)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>quad111 <span class="op">=</span> mk_quad_fn(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co"># quad111(actual_x_values)</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>predicted_quad111_y_values_tsr <span class="op">=</span> quad111(actual_x_values_tsr) <span class="co"># remember is a 2d tensor due to added dimension with: [:,None]</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co"># we have actual-yand predicted-y data, lets compare them</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mae_calc(actual, preds): <span class="cf">return</span> <span class="bu">abs</span>(preds<span class="op">-</span>actual).mean()</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>mae_calc(actual_y_values_realistic_tsr,predicted_quad111_y_values_tsr)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-72" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.plot(actual_y_values_realistic_tsr,predicted_quad111_y_values_tsr)</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(actual_x_values_tsr, actual_y_values_realistic_tsr)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot predictions</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># for predictions, graphically it will look better to plot a line </span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># rather than just a coressponding y-prediction to each actual y</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># lets do just corresponding ones first to see what it looks like</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>plt.scatter(actual_x_values_tsr, predicted_quad111_y_values_tsr)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-73" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(actual_x_values_tsr, actual_y_values_realistic_tsr)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.scatter(actual_x_values_tsr, predicted_quad111_y_values_tsr)</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot y-line prediction</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>plt.plot(actual_x_values_tsr, predicted_quad111_y_values_tsr, <span class="st">'r'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-74" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipywidgets <span class="im">import</span> interact</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="at">@interact</span>(a<span class="op">=</span><span class="dv">1</span>,b<span class="op">=</span><span class="dv">1</span>,c<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_both(a,b,c):</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># interactive_predicted_quad_y_values_tsr = custom_quad_fn(actual_x_values_tsr)</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    plt.scatter(actual_x_values_tsr, actual_y_values_realistic_tsr)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    actual_x_values_for_plotting_tsr <span class="op">=</span> torch.linspace(<span class="op">-</span><span class="fl">2.1</span>,<span class="fl">2.1</span>,<span class="dv">100</span>)[:,<span class="va">None</span>]</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    custom_quad_fn <span class="op">=</span> mk_quad_fn(a,b,c)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    interactive_predicted_quad_y_values_tsr <span class="op">=</span> custom_quad_fn(actual_x_values_for_plotting_tsr)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    plt.ylim((<span class="op">-</span><span class="dv">3</span>,<span class="dv">13</span>))</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    plt.plot(actual_x_values_for_plotting_tsr, interactive_predicted_quad_y_values_tsr, <span class="st">'r'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-77" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipywidgets <span class="im">import</span> interact</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. create synthetic data</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.1 create base data</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> quad(a,b,c,x): <span class="cf">return</span> a<span class="op">*</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> b<span class="op">*</span>x <span class="op">+</span> c</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> partial_quad_abc(a,b,c): <span class="cf">return</span> partial(quad,a,b,c)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>quad_321_fn <span class="op">=</span> partial_quad_abc(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="at">@interact</span>(a<span class="op">=</span><span class="dv">3</span>,b<span class="op">=</span><span class="dv">2</span>,c<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> func_plotter(a,b,c):</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    xs_input_tnsr <span class="op">=</span> torch.linspace(<span class="op">-</span><span class="fl">2.1</span>,<span class="fl">2.1</span>, steps<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    pred_model <span class="op">=</span> partial_quad_abc(a,b,c)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    ys_preds_tnsr <span class="op">=</span> pred_model(xs_input_tnsr)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    plt.xlim((<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    plt.ylim((<span class="op">-</span><span class="dv">1</span>,<span class="dv">15</span>))</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    plt.plot(xs_input_tnsr,ys_preds_tnsr)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-78" class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-79" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipywidgets <span class="im">import</span> interact</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 create model data</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> quad(a,b,c,x): <span class="cf">return</span> a<span class="op">*</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> b<span class="op">*</span>x <span class="op">+</span> c</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> partial_quad_abc(a,b,c): <span class="cf">return</span> partial(quad,a,b,c)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>quad_321_fn <span class="op">=</span> partial_quad_abc(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="at">@interact</span>(a<span class="op">=</span><span class="dv">3</span>,b<span class="op">=</span><span class="dv">2</span>,c<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> func_plotter(a,b,c):</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    xs_input_tnsr <span class="op">=</span> torch.linspace(<span class="op">-</span><span class="fl">2.1</span>,<span class="fl">2.1</span>, steps<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    pred_model <span class="op">=</span> partial_quad_abc(a,b,c)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    ys_preds_tnsr <span class="op">=</span> pred_model(xs_input_tnsr)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    plt.xlim((<span class="op">-</span><span class="fl">2.1</span>,<span class="fl">2.1</span>))</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    plt.ylim((<span class="op">-</span><span class="dv">1</span>,<span class="dv">15</span>))</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    plt.plot(xs_input_tnsr,ys_preds_tnsr)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e4e653c662fb46219305d049dad586c7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="cell-80" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. create syn data</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.1 noise</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> noise(tsr, scale): <span class="cf">return</span> np.random.normal(scale<span class="op">=</span>scale, size<span class="op">=</span>tsr.shape)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_scale_noise(tsr, add, scale):</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    scaled_noise <span class="op">=</span> noise(tsr, scale)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    adding_noise <span class="op">=</span> noise(tsr, add)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tsr<span class="op">*</span>(<span class="dv">1</span><span class="op">+</span>scaled_noise) <span class="op">+</span> adding_noise</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return tsr*(1+noise(tsr, scale)) + noise(tsr, add)</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>xs_actual_inputs <span class="op">=</span> xs_20samples_321_tsr <span class="op">=</span> torch.linspace(<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>,steps<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>ys_20samples_321_tsr <span class="op">=</span> quad_321_fn(xs_20samples_321_tsr)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>ys_actual <span class="op">=</span> ys_actual_noisy_321_tsr <span class="op">=</span> add_scale_noise(ys_20samples_321_tsr, <span class="fl">1.5</span>, <span class="fl">0.15</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.1 scale and add</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mae_calc(actual, preds): <span class="cf">return</span> torch.<span class="bu">abs</span>(preds<span class="op">-</span>actual).mean()</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="at">@interact</span>(a<span class="op">=</span><span class="dv">3</span>,b<span class="op">=</span><span class="dv">2</span>,c<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_pred_and_actual(a,b,c):</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    func_plotter(a,b,c)</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    plt.scatter(xs_actual_inputs,ys_actual, color<span class="op">=</span><span class="st">"r"</span>)</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    mae <span class="op">=</span> mae_calc(ys_actual,partial_quad_abc(a,b,c)(xs_actual_inputs))</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    plt.title(label<span class="op">=</span><span class="ss">f"MAE: </span><span class="sc">{</span>mae<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7f20ccc1fdec4c58ba6af1f1448a6073","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="cell-81" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># create function with </span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># input (params or a tnsr) and </span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># output (mae), hence apply gradient descent</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> loss_function(params):</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae = mae_calc(ys_actual,partial_quad_abc(a,b,c)(xs_actual_inputs))</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    ys_preds <span class="op">=</span> partial_quad_abc(<span class="op">*</span>params)(xs_actual_inputs)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    mae <span class="op">=</span> mae_calc(ys_actual,ys_preds)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mae</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-82" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. start with random param [abc_tsr] + [requires_grad]</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. calc [loss]</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. calc [gradients]</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. do [gradient_descent]</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. profit!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-83" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. start with random param [abc_tsr] + [requires_grad]</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>abc_tsr <span class="op">=</span> torch.tensor([<span class="fl">1.1</span>,<span class="fl">1.1</span>,<span class="fl">1.1</span>], requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. calc [loss]</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> loss_function(abc_tsr)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>loss </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. calc [gradients]</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co"># loss.backward()</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># abc_tsr.grad</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># loss.backward()</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>tensor(2.4219, dtype=torch.float64, grad_fn=&lt;MeanBackward0&gt;)</code></pre>
</div>
</div>
<div id="cell-84" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. do [gradient_descent]</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> loss_function(abc_tsr)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        abc_tsr <span class="op">-=</span> abc_tsr.grad <span class="op">*</span> <span class="fl">0.01</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(loss)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(abc_tsr.grad)</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(abc_tsr)</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(loss)</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(abc_tsr.grad*0.01)</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5. profit!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tensor(2.4219, dtype=torch.float64, grad_fn=&lt;MeanBackward0&gt;)
tensor(2.3386, dtype=torch.float64, grad_fn=&lt;MeanBackward0&gt;)
tensor(2.2345, dtype=torch.float64, grad_fn=&lt;MeanBackward0&gt;)</code></pre>
</div>
</div>
<div id="cell-85" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> loss_function(abc_tsr)  <span class="co"># Calculate loss outside computation graph</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        abc_tsr <span class="op">-=</span> abc_tsr.grad <span class="op">*</span> <span class="fl">0.01</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>loss<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'abc_tnsr' is not defined</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>